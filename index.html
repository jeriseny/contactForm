<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>문의 양식</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
<div class="wrap">
    <div class="card">
        <header>
            <h1 class="title">문의사항</h1>
            <p class="subtitle">궁금한 점이 있으시면 아래 양식으로 문의해주세요.</p>
        </header>

        <form id="contactForm">

            <div class="row">
                <label for="name" class="req">이름</label>
                <input type="text" id="name" name="name" placeholder="홍길동" required/>
            </div>

            <div class="row">
                <label for="email">이메일</label>
                <input type="email" id="email" name="email" placeholder="you@example.com"/>
                <p class="hint">회신 방법에서 이메일 선택 시 필수.</p>
            </div>

            <div class="row">
                <label for="phone">휴대폰 번호</label>
                <input type="tel" id="phone" name="phone" placeholder="010-0000-0000"/>
                <p class="hint">회신 방법에서 휴대폰 선택 시 필수.</p>
            </div>


            <div class="row">
                <label class="req">답변 받을 방법</label>
                <div class="methods" role="radiogroup" aria-label="답변 받을 방법">
                    <label class="pill"><input type="radio" name="reply" value="email" checked/> 이메일</label>
                    <label class="pill"><input type="radio" name="reply" value="phone"/> 휴대폰</label>
                    <label class="pill"><input type="radio" name="reply" value="none"/> 답변 불필요</label>
                </div>
            </div>

            <div class="row">
                <label for="subject">제목</label>
                <input type="text" id="subject" name="subject" placeholder="예) 견적 문의드립니다"/>
            </div>

            <div class="row">
                <label for="message" class="req">내용</label>
                <textarea id="message" name="message" placeholder="구체적으로 작성해주시면 더 빠르게 도와드려요." maxlength="1000"
                          required></textarea>
                <p class="hint"><span id="count">0</span>/1000</p>
            </div>

            <div class="row">
                <label for="agree" class="req">수집 동의</label>
                <div class="agree-line">
                    <input type="checkbox" id="agree" required/>
                    <label for="agree" class="agree-text">문의 응대 목적으로 이름/연락처/내용을 수집·보관(최대 1년)에 동의합니다.</label>
                </div>
            </div>

            <div class="actions">
                <button type="submit" id="submitBtn">보내기</button>
                <button type="button" class="ghost" id="resetBtn">초기화</button>
                <div id="status" aria-live="polite"></div>
            </div>

            <div class="divider"></div>
<!--            <p class="hint">전송 즉시 자동 저장됩니다. 민감정보는 기재하지 마세요.</p>-->
        </form>

        <footer class="footer">
            <small class="hint">© Your Company</small>
            <small class="hint">Google Apps Script 연동 데모</small>
        </footer>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbwimY5-gkQKMGahQA5tQSzrRmHLPVhelQTDIkxkBd6O7KZwkXBphbdvniQvlCnsNVz6VA/exec";
    const form = document.getElementById('contactForm');
    const btn = document.getElementById('submitBtn');
    const statusDiv = document.getElementById('status');

    document.getElementById('message').addEventListener('input', function () {
        document.getElementById('count').textContent = this.value.length;
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
        form.reset();
        document.getElementById('count').textContent = '0';
        statusDiv.textContent = '';
    });

    document.getElementById('phone').addEventListener('input', function(e) {
        // 숫자만 추출
        let value = this.value.replace(/[^0-9]/g, '');

        // 길이에 따라 하이픈 추가
        if (value.length > 3 && value.length <= 7) {
            // 010-1234 형식
            value = value.substring(0, 3) + '-' + value.substring(3);
        } else if (value.length > 7) {
            // 010-1234-5678 형식
            value = value.substring(0, 3) + '-' + value.substring(3, 7) + '-' + value.substring(7, 11);
        }

        if (value.length > 13) {
            value = value.substring(0, 13);
        }

        this.value = value;
    });


    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        btn.disabled = true;
        btn.textContent = '전송 중...';
        statusDiv.textContent = '';

        // const data = {
        //     name: document.getElementById('name').value,
        //     email: document.getElementById('email').value,
        //     phone: document.getElementById('phone').value,
        //     reply: form.querySelector('input[name="reply"]:checked')?.value || 'email',
        //     subject: document.getElementById('subject').value,
        //     message: document.getElementById('message').value,
        // };

        const formData = new FormData();
        formData.append("name", document.getElementById('name').value);
        formData.append("email", document.getElementById('email').value);
        formData.append("phone", document.getElementById('phone').value);
        formData.append("reply", form.querySelector('input[name="reply"]:checked')?.value || 'email');
        formData.append("subject", document.getElementById('subject').value);
        formData.append("message", document.getElementById('message').value);

        try {
            await fetch(GAS_URL, {
                method: "POST",
                body: formData
            });

            statusDiv.textContent = '전송 완료! 빠르게 확인하겠습니다.';
            statusDiv.style.color = '#34d399';
            form.reset();
            document.getElementById('count').textContent = '0';

        } catch (error) {
            console.error(error);
            statusDiv.textContent = '전송 중 오류가 발생했습니다.';
            statusDiv.style.color = '#ef4444';
        } finally {
            btn.disabled = false;
            btn.textContent = '보내기';
        }
    })

</script>
</body>
</html>
